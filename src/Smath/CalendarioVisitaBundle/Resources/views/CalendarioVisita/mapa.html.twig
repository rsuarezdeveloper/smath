<section id="widget-grid" class="">
<!-- row -->
<div class="row">
<article class="col-sm-12">
<!-- new widget -->
<div class="jarviswidget jarviswidget-color-blue" id="wid-id-4" data-widget-editbutton="false" data-widget-colorbutton="false">

								<!-- widget options:
								usage: <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">

								data-widget-colorbutton="false"
								data-widget-editbutton="false"
								data-widget-togglebutton="false"
								data-widget-deletebutton="false"
								data-widget-fullscreenbutton="false"
								data-widget-custombutton="false"
								data-widget-collapsed="true"
								data-widget-sortable="false"

								-->

								<header>
									<span class="widget-icon"> <i class="fa fa-check txt-color-white"></i> </span>
									<h2> Mi Ruta de Hoy </h2>
									<!-- <div class="widget-toolbar">
									add: non-hidden - to disable auto hide

									</div>-->
								</header>

								<!-- widget div-->
								<div>
									<!-- widget edit box -->
									<div class="jarviswidget-editbox">
										<div>
											<label>Title:</label>
											<input type="text" />
										</div>
									</div>
									<!-- end widget edit box -->

									<div class="widget-body no-padding smart-form">
										<!-- content goes here -->
                                        {%if citas%}
										<h5 class="todo-group-title"><i class="fa fa-warning"></i> Citas Pendientes (<small class="num-of-tasks">{{citas|length}}</small>)</h5>
										<ul id="sortable1" class="todo">

                                            {%for cita in citas if not cita.visitado%}
											<li>
												<span class="handle"> </span>
												<p>
                                                <strong>Cita #{{cita.id}}</strong> - {{cita.puntoVenta.nombre}} [<a href="javascript:void(0);" class="font-xs diligenciar_cita" cita="{{cita.id}}">Diligenciar</a>] <span class="text-muted">{{cita.puntoVenta.nombreAdministrador}} </span>
                                                    											<span class="date">{{cita.fechaProgramada|date('Y-m-d H:i:s')}}</span>


													<span id="div_cita_{{cita.id}}" style="display:none">
													    <label class="textarea">
													    <textarea name="obs_cita_{{cita.id}}" id="obs_cita_{{cita.id}}" cols="30" rows="10" placeholder="Diligencie aca su informaciÃ³n" class="textarea-resizable"></textarea>
                                                        </label>
													        <button class="btn btn-success btn_guardar_cita" cita="{{cita.id}}" > Guardar</button>
													</span>


												</p>
											</li>
                                            {%endfor%}

										</ul>


										<h5 class="todo-group-title"><i class="fa fa-check"></i> Visitas Completadas (<small class="num-of-tasks">0</small>)</h5>
										<ul id="sortable1" class="todo">
											{%for cita in citas if cita.visitado%}
                                            <li>
                                                <span class="handle"> </span>
												<p>
													<strong>Cita #{{cita.id}}</strong> - {{cita.puntoVenta.nombre}}  <span class="text-muted">{{cita.puntoVenta.nombreAdministrador}} </span>
													<span class="date">Jan 1, 2014</span>
													<span>{{cita.observaciones|raw}}</span>
												</p>
											</li>
                                            {%endfor%}
										</ul>
                                        {%else%}
                                        <div class="alert alert-danger">
                                        <h4>
                                            <i class="fa fa-warning"></i>
                                            Warning!
                                        </h4>
                                        No tiene visitas asignadas por el momento, pongase en contacto con su supervisor si cree que esto es incorrecto.</div>
                                        {%endif%}
										<!-- end content -->
									</div>

								</div>
								<!-- end widget div -->
							</div>
							<!-- end widget -->
    </article>
    </div>
</section>
{%block javascripts%}
<script>
    $(document).ready(function(){
        $(".diligenciar_cita").click(function(){
            var cita = $(this).attr('cita');
            $("#div_cita_"+cita).toggle();
        });
        $(".btn_guardar_cita").click(function(){
            var cita = $(this).attr('cita');
            var observaciones=$("#obs_cita_"+cita).val();
            $(this).parent().prepend('<i class="fa fa-refresh fa-spin"></i> Guardando... <BR>');
            var path ="{{path('calendariovisita_update',{id:'__id'})}}".replace('__id',cita);
            $.post(path,{observaciones:observaciones, __method:'PUT'},function(response){
                $("#hr1").load("{{path('calendariovisita_mapa')}}");
            })
        });
    })
</script>
{%endblock%}
